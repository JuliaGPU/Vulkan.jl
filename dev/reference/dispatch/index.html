<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API function dispatch · Vulkan.jl</title><meta name="title" content="API function dispatch · Vulkan.jl"/><meta property="og:title" content="API function dispatch · Vulkan.jl"/><meta property="twitter:title" content="API function dispatch · Vulkan.jl"/><meta name="description" content="Documentation for Vulkan.jl."/><meta property="og:description" content="Documentation for Vulkan.jl."/><meta property="twitter:description" content="Documentation for Vulkan.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Vulkan.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../intro/">Introduction</a></li><li><a class="tocitem" href="../../glossary/">Glossary</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../../tutorial/getting_started/">Getting started</a></li><li><a class="tocitem" href="../../tutorial/error_handling/">Error handling</a></li><li><a class="tocitem" href="../../tutorial/resource_management/">Resource management</a></li><li><a class="tocitem" href="../../tutorial/indepth/">In-depth tutorial</a></li><li><a class="tocitem" href="../../tutorial/minimal_working_compute/">Running compute shaders</a></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../../howto/preferences/">Specify package options</a></li><li><a class="tocitem" href="../../howto/debugging/">Debug an application</a></li><li><a class="tocitem" href="../../howto/handles/">Manipulate handles</a></li><li><a class="tocitem" href="../../howto/shaders/">Compile a SPIR-V shader from Julia</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../wrapper_types/">Wrapper types</a></li><li><a class="tocitem" href="../wrapper_functions/">Wrapper functions</a></li><li class="is-active"><a class="tocitem" href>API function dispatch</a><ul class="internal"><li><a class="tocitem" href="#Retrieving-function-pointers"><span>Retrieving function pointers</span></a></li><li><a class="tocitem" href="#Providing-function-pointers"><span>Providing function pointers</span></a></li><li><a class="tocitem" href="#Automatic-dispatch"><span>Automatic dispatch</span></a></li></ul></li><li><a class="tocitem" href="../options/">Package options</a></li></ul></li><li><span class="tocitem">Explanations</span><ul><li><a class="tocitem" href="../../about/motivations/">Motivations</a></li><li><a class="tocitem" href="../../about/extension_mechanism/">Extension mechanism</a></li><li><a class="tocitem" href="../../about/library_loading/">Library loading</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../utility/">Utility</a></li><li><a class="tocitem" href="../../troubleshooting/">Troubleshooting</a></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../../dev/overview/">Overview</a></li><li><a class="tocitem" href="../../dev/spec/">Vulkan specification</a></li><li><a class="tocitem" href="../../dev/gen/">Generator</a></li><li><a class="tocitem" href="../../dev/next_chains/">Next chains</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>API function dispatch</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API function dispatch</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaGPU/Vulkan.jl/blob/main/docs/src/reference/dispatch.jl#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Dispatch"><a class="docs-heading-anchor" href="#Dispatch">Dispatch mechanism</a><a id="Dispatch-1"></a><a class="docs-heading-anchor-permalink" href="#Dispatch" title="Permalink"></a></h1><p>Some API functions cannot be called directly from the Vulkan library. In particular, extension functions <em>must</em> be called through a pointer obtained via API commands. In addition, most functions can be made faster by calling directly into their function pointer, instead of going through the loader trampoline which resolves the function pointer every time.</p><p>To circumvent that, we provide a handy way for retrieving and calling into function pointers, as well as a thread-safe global dispatch table that can automate this work for you.</p><h2 id="Retrieving-function-pointers"><a class="docs-heading-anchor" href="#Retrieving-function-pointers">Retrieving function pointers</a><a id="Retrieving-function-pointers-1"></a><a class="docs-heading-anchor-permalink" href="#Retrieving-function-pointers" title="Permalink"></a></h2><p>API Function pointers can be obtained with the <a href="../../api/#Vulkan.function_pointer"><code>function_pointer</code></a> function, using the API function name.</p><pre><code class="language-julia hljs">using Vulkan

const instance = Instance([], [])
const pdevice = first(unwrap(enumerate_physical_devices(instance)))
const device = Device(pdevice, [DeviceQueueCreateInfo(0, [1.0])], [], [])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Device(Ptr{Nothing} @0x00000000071f4870)</code></pre><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; function_pointer(&quot;vkCreateInstance&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{Nothing} @0x00007f3d22dc5e50</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; function_pointer(instance, &quot;vkDestroyInstance&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{Nothing} @0x00007f3d22dc1540</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; function_pointer(device, &quot;vkCreateFence&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{Nothing} @0x00007f3d08dc9090</code></pre><p>It is essentially a wrapper around <code>get_instance_proc_addr</code> and <code>get_device_proc_addr</code>, leveraging multiple dispatch to make it more intuitive to use.</p><h2 id="Providing-function-pointers"><a class="docs-heading-anchor" href="#Providing-function-pointers">Providing function pointers</a><a id="Providing-function-pointers-1"></a><a class="docs-heading-anchor-permalink" href="#Providing-function-pointers" title="Permalink"></a></h2><p>Every wrapper function or handle constructor has a signature which accepts the standard function arguments plus a function pointer to call into. For example, instead of doing</p><pre><code class="language-julia hljs">foreach(println, unwrap(enumerate_instance_layer_properties()))</code></pre><p>you can do</p><pre><code class="language-julia hljs">fptr = function_pointer(&quot;vkEnumerateInstanceLayerProperties&quot;)
foreach(println, unwrap(enumerate_instance_layer_properties(fptr)))</code></pre><p>In the case of a handle constructor which calls both a creation and a destruction function, there is an argument for each corresponding function pointer:</p><pre><code class="language-julia hljs">fptr_create = function_pointer(device, &quot;vkCreateFence&quot;)
fptr_destroy = function_pointer(device, &quot;vkDestroyFence&quot;)
Fence(device, fptr_create, fptr_destroy)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Fence(Ptr{Nothing} @0x0000000006de2d68)</code></pre><h2 id="Automatic-dispatch"><a class="docs-heading-anchor" href="#Automatic-dispatch">Automatic dispatch</a><a id="Automatic-dispatch-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-dispatch" title="Permalink"></a></h2><p>Querying and retrieving function pointers every time results in a lot of boilerplate code. To remedy this, we provide a concurrent global dispatch table which loads all available function pointers for loader, instance and device commands. It has one dispatch table per instance and per device to support using multiple instances and devices at the same time.</p><p>This feature can be disabled by setting the <a href="../options/#Package-options">preference</a> <code>USE_DISPATCH_TABLE</code> to <code>&quot;false&quot;</code>.</p><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p>All instance and device creations must be externally synchronized if the dispatch table is enabled. This is because all function pointers are retrieved and stored right after the creation of an instance or device handle.</p></div></div><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../wrapper_functions/">« Wrapper functions</a><a class="docs-footer-nextpage" href="../options/">Package options »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.0 on <span class="colophon-date" title="Monday 29 July 2024 15:00">Monday 29 July 2024</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
