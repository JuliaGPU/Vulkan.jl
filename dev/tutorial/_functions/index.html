<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Vulkan functions · Vulkan.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Vulkan.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../intro/">Introduction</a></li><li><span class="tocitem">About</span><ul><li><a class="tocitem" href="../../about/motivations/">Motivations</a></li><li><a class="tocitem" href="../../about/_interfacing/">Interfacing with the C API</a></li></ul></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../getting_started/">Getting started</a></li><li><a class="tocitem" href="../_types/">Vulkan types</a></li><li class="is-active"><a class="tocitem" href>Vulkan functions</a><ul class="internal"><li><a class="tocitem" href="#Implicit-return-values"><span>Implicit return values</span></a></li><li><a class="tocitem" href="#Queries"><span>Queries</span></a></li></ul></li><li><a class="tocitem" href="../_error_handling/">Error handling</a></li><li><a class="tocitem" href="../_resource_management/">Resource management</a></li><li><a class="tocitem" href="../_indepth/">In-depth tutorial</a></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../../howto/_preferences/">Setting preferences</a></li><li><a class="tocitem" href="../../howto/_debugging/">Debugging</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../utility/">Utility</a></li><li><a class="tocitem" href="../../troubleshooting/">Troubleshooting</a></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../../dev/overview/">Overview</a></li><li><a class="tocitem" href="../../dev/spec/">Vulkan specification</a></li><li><a class="tocitem" href="../../dev/gen/">Generator</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Vulkan functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Vulkan functions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaGPU/Vulkan.jl/blob/master/docs/src/tutorial/functions.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Vulkan-functions"><a class="docs-heading-anchor" href="#Vulkan-functions">Vulkan functions</a><a id="Vulkan-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Vulkan-functions" title="Permalink"></a></h1><p>Functions in C behave differently that in Julia. In particular, they can&#39;t return multiple values and mutate pointer memory instead. Other patterns emerge from the use of pointers with a separately-provided length, where a length/size parameter can be queried, so that you build a pointer with the right size, and pass it in to the API to be filled with data. All these patterns were automated, so that wrapper functions feel a lot more natural and straightforward for Julia users than the API functions.</p><h2 id="Implicit-return-values"><a class="docs-heading-anchor" href="#Implicit-return-values">Implicit return values</a><a id="Implicit-return-values-1"></a><a class="docs-heading-anchor-permalink" href="#Implicit-return-values" title="Permalink"></a></h2><p>Functions almost never directly return a value in Vulkan, and usually return either a return code or nothing. This is a limitation of C where only one value can be returned. Instead, they fill pointers with data, and it is your responsibility to initialize them before the call and dereference them afterwards. Here is an example:</p><pre><code class="language-julia">using Vulkan
using Vulkan.core

function example_create_instance()
    instance_ref = Ref{VkInstance}()
    # we&#39;ll cheat a bit for the create info
    code = vkCreateInstance(
        InstanceCreateInfo([], []), # create info
        C_NULL,                     # allocator
        instance_ref,
    )

    @assert code == VK_SUCCESS

    instance_ref[]
end

example_create_instance()</code></pre><pre class="documenter-example-output">Ptr{Nothing} @0x0000000003b5bb90</pre><p>We did not create a <code>VkInstanceCreateInfo</code> to stay concise. Note that the create info structure can be used as is by the <code>vkCreateInstance</code>, even if it is a wrapper. Indeed, it implements <code>Base.cconvert</code> and <code>Base.unsafe_convert</code> to automatically interface with the C API.</p><p>All this setup code is now automated by the wrapper:</p><pre><code class="language-julia">instance = unwrap(create_instance(InstanceCreateInfo([], []); allocator=C_NULL))</code></pre><pre class="documenter-example-output">Instance(Ptr{Nothing} @0x0000000003b65eb0)</pre><p>Note that the <code>create_instance</code> wrapper returns a <code>ResultTypes.Result</code> type, so the result must be unwrapped to be used. To know more about <code>unwrap</code> and the <code>Result</code> type see the <a href="../_error_handling/#error-handling">Error handling</a> section.</p><p>When there are multiple implicit return values (i.e. multiple pointers being written to), they are returned as a tuple:</p><pre><code class="language-julia">actual_data_size, data = unwrap(get_pipeline_cache_data(device, pipeline_cache, data_size))</code></pre><h2 id="Queries"><a class="docs-heading-anchor" href="#Queries">Queries</a><a id="Queries-1"></a><a class="docs-heading-anchor-permalink" href="#Queries" title="Permalink"></a></h2><h3 id="Enumerated-items"><a class="docs-heading-anchor" href="#Enumerated-items">Enumerated items</a><a id="Enumerated-items-1"></a><a class="docs-heading-anchor-permalink" href="#Enumerated-items" title="Permalink"></a></h3><p>Sometimes, when enumerating objects or properties for example, a function may need to be called twice: a first time for returning the number of elements to be enumerated, then a second time with an initialized array of the right length to be filled with Vulkan objects:</p><pre><code class="language-julia">function example_enumerate_physical_devices(instance)
    pPhysicalDeviceCount = Ref{UInt32}(0)

    # get the length in pPhysicalDeviceCount
    code = vkEnumeratePhysicalDevices(instance, pPhysicalDeviceCount, C_NULL)

    @assert code == VK_SUCCESS
    # initialize the array with the returned length
    pPhysicalDevices = Vector{VkPhysicalDevice}(undef, pPhysicalDeviceCount[])

    # fill the array
    code = vkEnumeratePhysicalDevices(instance, pPhysicalDeviceCount, pPhysicalDevices)
    @assert code == VK_SUCCESS

    pPhysicalDevices
end

example_enumerate_physical_devices(instance)</code></pre><pre class="documenter-example-output">2-element Vector{Ptr{Nothing}}:
 Ptr{Nothing} @0x000000000354dda0
 Ptr{Nothing} @0x0000000004115270</pre><p>The relevant enumeration functions are wrapped with this, so that only one call needs to be made, without worrying about creating intermediate arrays:</p><pre><code class="language-julia">unwrap(enumerate_physical_devices(instance))</code></pre><pre class="documenter-example-output">2-element Vector{PhysicalDevice}:
 PhysicalDevice(Ptr{Nothing} @0x000000000354dda0)
 PhysicalDevice(Ptr{Nothing} @0x0000000004115270)</pre><h3 id="Incomplete-retrieval"><a class="docs-heading-anchor" href="#Incomplete-retrieval">Incomplete retrieval</a><a id="Incomplete-retrieval-1"></a><a class="docs-heading-anchor-permalink" href="#Incomplete-retrieval" title="Permalink"></a></h3><p>Some API commands such as <code>vkEnumerateInstanceLayerProperties</code> may return a <code>VK_INCOMPLETE</code> code indicating that some items could not be written to the provided array. This happens if the number of available items changes after that the length is obtained, making the array too small. In this case, it is recommended to simply query the length again, and provide a vector of the updated size, starting over if the number of items changes again. To avoid doing this by hand, this step is automated in a while loop. Here is what it may look like:</p><pre><code class="language-julia">function example_enumerate_physical_devices_2(instance)
    pPhysicalDeviceCount = Ref{UInt32}(0)

    @assert vkEnumeratePhysicalDevices(instance, pPhysicalDeviceCount, C_NULL) == VK_SUCCESS
    pPhysicalDevices = Vector{VkPhysicalDevice}(undef, pPhysicalDeviceCount[])
    code = vkEnumeratePhysicalDevices(instance, pPhysicalDeviceCount, pPhysicalDevices)

    while code == VK_INCOMPLETE
        @assert vkEnumeratePhysicalDevices(instance, pPhysicalDeviceCount, C_NULL) == VK_SUCCESS
        pPhysicalDevices = Vector{VkPhysicalDevice}(undef, pPhysicalDeviceCount[])
        code = vkEnumeratePhysicalDevices(instance, pPhysicalDeviceCount, pPhysicalDevices)
    end

    pPhysicalDevices
end

example_enumerate_physical_devices_2(instance)</code></pre><pre class="documenter-example-output">2-element Vector{Ptr{Nothing}}:
 Ptr{Nothing} @0x000000000354dda0
 Ptr{Nothing} @0x0000000004115270</pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../_types/">« Vulkan types</a><a class="docs-footer-nextpage" href="../_error_handling/">Error handling »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.3 on <span class="colophon-date" title="Sunday 11 July 2021 11:11">Sunday 11 July 2021</span>. Using Julia version 1.6.0-rc1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
