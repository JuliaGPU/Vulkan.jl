<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Next chains · Vulkan.jl</title><meta name="title" content="Next chains · Vulkan.jl"/><meta property="og:title" content="Next chains · Vulkan.jl"/><meta property="twitter:title" content="Next chains · Vulkan.jl"/><meta name="description" content="Documentation for Vulkan.jl."/><meta property="og:description" content="Documentation for Vulkan.jl."/><meta property="twitter:description" content="Documentation for Vulkan.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Vulkan.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../intro/">Introduction</a></li><li><a class="tocitem" href="../../glossary/">Glossary</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../../tutorial/getting_started/">Getting started</a></li><li><a class="tocitem" href="../../tutorial/error_handling/">Error handling</a></li><li><a class="tocitem" href="../../tutorial/resource_management/">Resource management</a></li><li><a class="tocitem" href="../../tutorial/indepth/">In-depth tutorial</a></li><li><a class="tocitem" href="../../tutorial/minimal_working_compute/">Running compute shaders</a></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../../howto/preferences/">Specify package options</a></li><li><a class="tocitem" href="../../howto/debugging/">Debug an application</a></li><li><a class="tocitem" href="../../howto/handles/">Manipulate handles</a></li><li><a class="tocitem" href="../../howto/shaders/">Compile a SPIR-V shader from Julia</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../reference/wrapper_types/">Wrapper types</a></li><li><a class="tocitem" href="../../reference/wrapper_functions/">Wrapper functions</a></li><li><a class="tocitem" href="../../reference/dispatch/">API function dispatch</a></li><li><a class="tocitem" href="../../reference/options/">Package options</a></li></ul></li><li><span class="tocitem">Explanations</span><ul><li><a class="tocitem" href="../../about/motivations/">Motivations</a></li><li><a class="tocitem" href="../../about/extension_mechanism/">Extension mechanism</a></li><li><a class="tocitem" href="../../about/library_loading/">Library loading</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../utility/">Utility</a></li><li><a class="tocitem" href="../../troubleshooting/">Troubleshooting</a></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../spec/">Vulkan specification</a></li><li><a class="tocitem" href="../gen/">Generator</a></li><li class="is-active"><a class="tocitem" href>Next chains</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer documentation</a></li><li class="is-active"><a href>Next chains</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Next chains</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaGPU/Vulkan.jl/blob/main/docs/src/dev/next_chains.md#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Next-chains"><a class="docs-heading-anchor" href="#Next-chains">Next chains</a><a id="Next-chains-1"></a><a class="docs-heading-anchor-permalink" href="#Next-chains" title="Permalink"></a></h1><p>Vulkan has a concept of <code>next</code> chains, where API structures can be chained together by filling an optional <code>next</code> field in a nested manner (hence the name).</p><p>This poses a few challenges on the Julia side, because in Vulkan such chains are linked lists which use raw pointers. Raw pointers are the reason why we required so-called intermediate structures that wrap core structures. As a reminder, these intermediate structures are nothing more than a core structure put alongside a vector of dependencies which holds Julia objects (arrays or references). These dependencies are what guarantees the validity of pointers present in the core structure, by making the garbage collector aware that these references must not be freed as long as the core structure is used (i.e., as long as the intermediate wrapper is used).</p><p>Having linked lists with opaque pointers complicate the matter. First, one must be able to build such chains to pass in the data structures to Vulkan in the format the API expects. That is the easiest part, since we can have arbitrary objects in the <code>next</code> field of high-level wrappers. From there, we can build a reference (<code>Ref</code>) to these (immutable) objects and then turn these references into pointers.</p><p>The Vulkan API sometimes makes use of a pattern where a <code>next</code> chain gets filled by an API command, such as <code>vkGetPhysicalDeviceProperties2</code>. The challenge then lies in initializing an empty intermediate object for Vulkan to fill in. We must construct core objects recursively with the right dependencies; care must be taken because every core object that is used in the chain must be saved as a dependency, but must also contain <code>next</code> members recursively. Therefore, in the initialization logic (implemented in <a href="#Vulkan.initialize"><code>initialize</code></a>), core objects are initialized via <a href="#Vulkan.initialize_core"><code>initialize_core</code></a> and their corresponding reference (if the object is not the root object) is filled with the result to be retained in the only intermediate structure that will contain the whole chain.</p><p>Reconstructing the original object is fairly straightforward. If the result is meant to be an intermediate structure, we can simply wrap the core object, the dependency being the original intermediate object that was used to initialize the object and its chain. If we want a high-level structure instead, then we need to chase pointers iteratively from the <code>next</code> chain of the core object, reconstructing the <code>next</code> objects by loading the pointers as we go along.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vulkan.initialize" href="#Vulkan.initialize"><code>Vulkan.initialize</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">initialize(T, next_Ts...)</code></pre><p>Initialize a value or Vulkan structure with the purpose of being filled in by the API. The types can be either high-level or intermediate wrapper types.</p><p>If <code>next_Ts</code> is not empty and <code>T</code> designates a Vulkan structure which can hold <code>next</code> chains, then the corresponding types will be initialized and added to the <code>next</code>/<code>pNext</code> member.</p><pre><code class="language-julia hljs">initialize(
    T::Union{Type{&lt;:Vulkan.HighLevelStruct}, Type{&lt;:VulkanStruct}},
    args...
) -&gt; Any
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaGPU/Vulkan.jl/blob/f8b709f143f2bd830c5d3326a78becf5ee11be84/src/prewrap/pointers.jl#LL121">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vulkan.initialize_core" href="#Vulkan.initialize_core"><code>Vulkan.initialize_core</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">initialize_core(T, next_refs)</code></pre><p>Initialize a core Vulkan structure, with <code>next</code> chain types specified in <code>refs</code>.</p><p>Every ref in <code>refs</code> will be used to construct an initialized <code>pNext</code> element, and will be filled with the <em>value</em> of the initialized type, acting as the pointer. Note that these references will have to be preserved for the initialized Vulkan structure to remain valid.</p><pre><code class="language-julia hljs">initialize_core(T, refs) -&gt; Any
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaGPU/Vulkan.jl/blob/f8b709f143f2bd830c5d3326a78becf5ee11be84/src/prewrap/pointers.jl#LL83">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gen/">« Generator</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.0 on <span class="colophon-date" title="Saturday 16 November 2024 01:52">Saturday 16 November 2024</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
